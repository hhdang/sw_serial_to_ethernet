
<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Transitional//EN"
  "http://www.w3.org/TR/xhtml1/DTD/xhtml1-transitional.dtd">

<html xmlns="http://www.w3.org/1999/xhtml">
  <head>
    <meta http-equiv="Content-Type" content="text/html; charset=utf-8" />
    
    <title>Programming guide &mdash; Serial to Ethernet bridging application manual v documentation</title>
    <link rel="stylesheet" href="_static/xdoc.css" type="text/css" />
    <link rel="stylesheet" href="_static/pygments.css" type="text/css" />
    <script type="text/javascript">
      var DOCUMENTATION_OPTIONS = {
        URL_ROOT:    '',
        VERSION:     '',
        COLLAPSE_INDEX: false,
        FILE_SUFFIX: '.html',
        HAS_SOURCE:  true
      };
    </script>
    <script type="text/javascript" src="_static/jquery.js"></script>
    <script type="text/javascript" src="_static/underscore.js"></script>
    <script type="text/javascript" src="_static/doctools.js"></script>
    <script type="text/javascript" src="_static/xcomment.js"></script>
    <link rel="top" title="Serial to Ethernet bridging application manual v documentation" href="index.html" />
    <link rel="next" title="API" href="api.html" />
    <link rel="prev" title="System description" href="system_description.html" /> 

<script>
function setheight() {
h1 = document.getElementById('d1').style.height;
h2 = document.getElementById('d2').style.height;

if (parseInt(h1) > parseInt(h2)) {
document.getElementById('d2').style.height=h1 + "px";
}
else {
document.getElementById('d1').style.height=h2 + "px";
}

}
</script>
</head>

<body onload="setheight();">

  

    <div class="document" id='d1'>
      <div class="documentwrapper">
        <div class="bodywrapper">
          <div class="body">
<div style="float: right">
<a href="system_description.html"
                        title="previous chapter"> &lt&lt </a>
<a href="api.html"
                        title="next chapter"> &gt&gt </a></p>
</div>

            
  <div class="section" id="programming-guide">
<h1>Programming guide<a class="headerlink" href="#programming-guide" title="Permalink to this headline">¶</a></h1>
<div class="section" id="getting-started">
<h2>Getting started<a class="headerlink" href="#getting-started" title="Permalink to this headline">¶</a></h2>
<div class="section" id="installation">
<h3>Installation<a class="headerlink" href="#installation" title="Permalink to this headline">¶</a></h3>
<dl class="docutils">
<dt>The following components are required to build the <em>Serial to Ethernet application</em>:</dt>
<dd><ul class="first last simple">
<li>sw_serial_to_ethernet: git://github.com/xcore/sw_serial_to_ethernet</li>
<li>sc_multi_uart: git://github.com/xcore/sc_multi_uart.git</li>
<li>sc_xtcp: git://github.com/xcore/sc_xtcp.git</li>
<li>sc_ethernet: git://github.com/xcore/sc_ethernet.git</li>
<li>sc_util: git://github.com/xcore/sc_util.git</li>
<li>sc_website: git://github.com/xcore/sc_website.git</li>
<li>sc_slicekit_support: git://github.com/xcore/sc_slicekit_support</li>
<li>sc_otp: git://github.com/xcore/sc_otp</li>
</ul>
</dd>
</dl>
<p>All these components are packaged in the software distribution folder. Once these files are extracted, you can install, build and use the software.</p>
<div class="section" id="import-and-build-procedure-using-xtimecomposer-studio">
<h4>Import and build procedure using xTIMEcomposer studio<a class="headerlink" href="#import-and-build-procedure-using-xtimecomposer-studio" title="Permalink to this headline">¶</a></h4>
<p>To install the software, open the xTIMEcomposer (v13.0.0 or later) and follow these steps:</p>
<ol class="arabic simple">
<li>Open the xTIMEcomposer studio.</li>
<li>Open the <em>Edit</em> perspective (Window -&gt; Open Perspective -&gt; XMOS Edit).</li>
<li>Click <em>Import</em> option in the <em>Project Explorer</em> window (Import -&gt; General -&gt; Existing Projects into Workspace and click Next).</li>
<li>Choose <em>Select archive file</em> option and click <em>Browse</em> button.</li>
<li>Select s2e release zip file and click <em>Finish</em> button</li>
<li>The application is called as <em>app_serial_to_ethernet</em> in the <em>Project Explorer</em> window.</li>
</ol>
<p>Build the <tt class="docutils literal"><span class="pre">serial</span> <span class="pre">to</span> <span class="pre">ethernet</span></tt> application:</p>
<ol class="arabic simple">
<li>Click on the <em>app_serial_to_ethernet</em> item in the <em>Project Explorer</em> window.</li>
<li>Click on the <em>Build</em> (indicated by a &#8216;Hammer&#8217; picture) icon.</li>
<li>Check the <em>Console</em> window to verify that the application has built successfully.</li>
</ol>
</div>
</div>
<div class="section" id="flash-the-web-pages-and-device-configuration">
<h3>Flash the web pages and device configuration<a class="headerlink" href="#flash-the-web-pages-and-device-configuration" title="Permalink to this headline">¶</a></h3>
<p>To flash the web pages and device configuration using xTIMEcomposer studio:</p>
<ol class="arabic simple">
<li>In the <em>Project Explorer</em> window, locate the <em>app_serial_to_ethernet.xe</em> and <em>web_data.bin</em> in the (app_serial_to_ethernet -&gt; bin).</li>
<li>Right click on <em>app_serial_to_ethernet.xe</em> and click on (Flash As -&gt; Flash Configurations...).</li>
<li>In the <em>Flash Configurations</em> window, double click the <em>xCORE Application</em> to create a new flash configuration.</li>
<li>Navigate to <em>XFlash Options</em> tab and apply the following settings:<ul>
<li>Check <em>Boot partition size (bytes):</em> and its value as 0x10000</li>
<li><em>Other XFlash Options:</em> as &#8211;data bin/web_data.bin</li>
</ul>
</li>
<li>Click on <em>Apply</em> and then <em>Flash</em> to the XMOS device.</li>
<li>Check the <em>Console</em> window to verify flashing progress.</li>
</ol>
<div class="section" id="building-from-command-line-tool">
<h4>Building from command line tool<a class="headerlink" href="#building-from-command-line-tool" title="Permalink to this headline">¶</a></h4>
<p>To build from the command line, navigate to <cite>app_serial_to_ethernet</cite> directory and execute the command:</p>
<blockquote>
<div>xmake all</div></blockquote>
<p>Inorder to build the firmware with a static IP (say 169.254.196.178), execute the following command:</p>
<blockquote>
<div>xmake all STATIC_IP=169.254.196.178</div></blockquote>
<p>To flash the application, configration and web pages, execute the command:</p>
<blockquote>
<div>xmake flash</div></blockquote>
</div>
</div>
</div>
<div class="section" id="source-code-structure">
<h2>Source code structure<a class="headerlink" href="#source-code-structure" title="Permalink to this headline">¶</a></h2>
<div class="section" id="directory-structure">
<h3>Directory structure<a class="headerlink" href="#directory-structure" title="Permalink to this headline">¶</a></h3>
<p>The source code is split into application source code and web pages.
The application builds into a single executable using the source code from the modules.
The modules used by an application are specified using the <tt class="docutils literal"><span class="pre">USED_MODULES</span></tt> variable in
the application Makefile.</p>
<p>The source package contains:</p>
<table border="1" class="docutils">
<colgroup>
<col width="50%" />
<col width="50%" />
</colgroup>
<thead valign="bottom">
<tr><th class="head">Directory</th>
<th class="head">Description</th>
</tr>
</thead>
<tbody valign="top">
<tr><td>src</td>
<td>Source files that implement application functionality</td>
</tr>
<tr><td>web</td>
<td>Web (html) pages used by the web server module</td>
</tr>
<tr><td>images</td>
<td>Images that are displayed on the web (html) pages</td>
</tr>
</tbody>
</table>
<p>Supported modules originate from other repositories:</p>
<table border="1" class="docutils">
<colgroup>
<col width="33%" />
<col width="33%" />
<col width="33%" />
</colgroup>
<thead valign="bottom">
<tr><th class="head">Directory</th>
<th class="head">Description</th>
<th class="head">Repository</th>
</tr>
</thead>
<tbody valign="top">
<tr><td>module_mii_singlethread</td>
<td>Lite version of low level ethernet interface over MII</td>
<td>sc_ethernet</td>
</tr>
<tr><td>module_ethernet_smi</td>
<td>A library code to communicate with ethernet phy using the SMI protocol</td>
<td>sc_ethernet</td>
</tr>
<tr><td>module_xtcp</td>
<td>XTCP TCP/IP stack</td>
<td>sc_xtcp</td>
</tr>
<tr><td>module_multi_uart</td>
<td>Multiple UART TX server and RX server</td>
<td>sc_multi_uart</td>
</tr>
<tr><td>module_xc_ptr</td>
<td>A library to allow XC code to access pointers via inline assembly calls.</td>
<td>sc_util</td>
</tr>
<tr><td>module_website</td>
<td>Embedded website component</td>
<td>sc_website</td>
</tr>
<tr><td>module_mutual_thread_comm</td>
<td>A protocol that allows two cores to communicate</td>
<td>sc_util</td>
</tr>
</tbody>
</table>
</div>
<div class="section" id="key-files">
<h3>Key files<a class="headerlink" href="#key-files" title="Permalink to this headline">¶</a></h3>
<table border="1" class="docutils">
<colgroup>
<col width="50%" />
<col width="50%" />
</colgroup>
<thead valign="bottom">
<tr><th class="head">File</th>
<th class="head">Description</th>
</tr>
</thead>
<tbody valign="top">
<tr><td><tt class="docutils literal"><span class="pre">xtcp_client_conf.h</span></tt></td>
<td>Header file for clients of the TCP/IP stack.</td>
</tr>
<tr><td><tt class="docutils literal"><span class="pre">udp_discovery.h</span></tt></td>
<td>Header file for declaring UDP port, firmware version and function declarations required for s2e device discovery</td>
</tr>
<tr><td><tt class="docutils literal"><span class="pre">uart_config.h</span></tt></td>
<td>Header file containing delclarations for UART data strcutures and interfacing with multi-uart server component</td>
</tr>
<tr><td><tt class="docutils literal"><span class="pre">web_server_conf.h</span></tt></td>
<td>Header file declaring all the functions called from the web pages</td>
</tr>
<tr><td><tt class="docutils literal"><span class="pre">telnet_config.h</span></tt></td>
<td>Header file for configuring UARTs via telnet socket</td>
</tr>
<tr><td><tt class="docutils literal"><span class="pre">multi_uart_rx_conf.h</span></tt></td>
<td>Header file for multiUART RX server configuration</td>
</tr>
<tr><td><tt class="docutils literal"><span class="pre">multi_uart_tx_conf.h</span></tt></td>
<td>Header file for multiUART TX server configuration</td>
</tr>
<tr><td><tt class="docutils literal"><span class="pre">s2e_conf.h</span></tt></td>
<td>Header file to enable debug options for s2e application</td>
</tr>
</tbody>
</table>
</div>
</div>
<div class="section" id="notes-on-application-interfaces">
<h2>Notes on application interfaces<a class="headerlink" href="#notes-on-application-interfaces" title="Permalink to this headline">¶</a></h2>
<p>This section provides a brief description on main application interfaces.</p>
<div class="section" id="uart-configuration">
<h3>UART configuration<a class="headerlink" href="#uart-configuration" title="Permalink to this headline">¶</a></h3>
<p>The initialisation and configuration process for both the RX and TX operations is the same. The files <tt class="docutils literal"><span class="pre">multi_uart_tx_conf.h</span></tt> and <tt class="docutils literal"><span class="pre">multi_uart_rx_conf.h</span></tt> are used to configure multiUART TX and RX servers for the default values. For application configuration, the function <a class="reference internal" href="api.html#uart_config_init" title="uart_config_init"><span>uart_config_init()</span></a> is used to apply configuration stored from flash or to use default application defined static configuration. The function <tt class="xref c c-func docutils literal"><span class="pre">uart_set_config()</span></tt> is utilised whenever there is a dynamic configuration change request (ie., a particular UART reconfiguration request). The flow is visualised in <a class="reference internal" href="#fig-uart-init-flow"><span>UART configuration flow</span></a>.</p>
<div class="figure align-center" id="fig-uart-init-flow">
<img alt="_images/muart_config_flow.png" src="_images/muart_config_flow.png" style="width: 50%;" />
<p class="caption">UART configuration flow</p>
</div>
</div>
<div class="section" id="webserver">
<h3>Webserver<a class="headerlink" href="#webserver" title="Permalink to this headline">¶</a></h3>
<p>The webserver handles all HTTP requests from the web clients. A web client may request to change UART settings, save current settings, or apply the previously saved UART seetings etc. Webserver identifies these requests, validates them and services those requests. It calls appropriate UART handler api&#8217;s to retrieve and set channel settings. For example, for a &#8216;Set&#8217; request from the web page, the webserver handler utilizes website component in order to parse the form data from web page, the required UART parameters are extracted and the UART_Handler&#8217;s uart_set_config api is called to set the new UART configuration.</p>
<p>The Webserver interface utilises sc_website component to implement web server functionality. Refer to the Programming Guide section within the <tt class="docutils literal"><span class="pre">SliceKit</span> <span class="pre">GPIO</span> <span class="pre">Example</span> <span class="pre">Applications</span></tt> documentation linked from the front page documentation of <tt class="docutils literal"><span class="pre">sw_gpio_examples</span></tt> repository (git://github.com/xcore/sw_gpio_examples.git). This documentation contains more information on how to utilize the <tt class="docutils literal"><span class="pre">Embedded</span> <span class="pre">Webserver</span> <span class="pre">Function</span> <span class="pre">Library</span></tt> component in customizing web server applications.</p>
</div>
<div class="section" id="flash-interface">
<h3>Flash interface<a class="headerlink" href="#flash-interface" title="Permalink to this headline">¶</a></h3>
<dl class="docutils">
<dt>The s2e_flash core handles data to/from flash fitted on board. The UART configuration web (html) pages, UART settings and IP configuration are typically stored into flash. Web pages are retrieved upon request from the client to the web server. UART settings can be &#8216;saved&#8217; and &#8216;restored&#8217; from flash. They are usually done via:</dt>
<dd><ul class="first last simple">
<li>Request from web page (HTTP request)</li>
<li>From Telnet configuration server</li>
<li>Upon startup (to restore restore last saved settings)</li>
</ul>
</dd>
</dl>
<p>IP configuration is saved via UDP server request and is requested from flash upon start-up.</p>
</div>
</div>
</div>



          </div>
        </div>
      </div>
      <div class="sphinxsidebar" id='d2'>
        <div class="sphinxsidebarwrapper">
<h3><a href="index.html">Serial to Ethernet bridging application manual</a></h3>
<ul class="current">
<li class="toctree-l1"><a class="reference internal" href="overview.html">Application Overview</a></li>
<li class="toctree-l1"><a class="reference internal" href="hardware_platform.html">Hardware platforms</a></li>
<li class="toctree-l1"><a class="reference internal" href="system_description.html">System description</a></li>
<li class="toctree-l1 current"><a class="current reference internal" href="">Programming guide</a><ul>
<li class="toctree-l2"><a class="reference internal" href="#getting-started">Getting started</a><ul>
<li class="toctree-l3"><a class="reference internal" href="#installation">Installation</a><ul>
<li class="toctree-l4"><a class="reference internal" href="#import-and-build-procedure-using-xtimecomposer-studio">Import and build procedure using xTIMEcomposer studio</a></li>
</ul>
</li>
<li class="toctree-l3"><a class="reference internal" href="#flash-the-web-pages-and-device-configuration">Flash the web pages and device configuration</a><ul>
<li class="toctree-l4"><a class="reference internal" href="#building-from-command-line-tool">Building from command line tool</a></li>
</ul>
</li>
</ul>
</li>
<li class="toctree-l2"><a class="reference internal" href="#source-code-structure">Source code structure</a><ul>
<li class="toctree-l3"><a class="reference internal" href="#directory-structure">Directory structure</a></li>
<li class="toctree-l3"><a class="reference internal" href="#key-files">Key files</a></li>
</ul>
</li>
<li class="toctree-l2"><a class="reference internal" href="#notes-on-application-interfaces">Notes on application interfaces</a><ul>
<li class="toctree-l3"><a class="reference internal" href="#uart-configuration">UART configuration</a></li>
<li class="toctree-l3"><a class="reference internal" href="#webserver">Webserver</a></li>
<li class="toctree-l3"><a class="reference internal" href="#flash-interface">Flash interface</a></li>
</ul>
</li>
</ul>
</li>
<li class="toctree-l1"><a class="reference internal" href="api.html">API</a></li>
<li class="toctree-l1"><a class="reference internal" href="using_the_application.html">Using the application</a></li>
<li class="toctree-l1"><a class="reference internal" href="references.html">References</a></li>
</ul>

<div id="searchbox" style="display: none;margin-bottom: 10px;">
  <h3>Search</h3>
    <form class="search" action="search.html" method="get">
      <input type="text" name="q" size="18" />
      <input type="submit" value="Go" />
      <input type="hidden" name="check_keywords" value="yes" />
      <input type="hidden" name="area" value="default" />
    </form>
</div>
<script type="text/javascript">$('#searchbox').show(0);</script>
        </div>
      </div>
      <div class="clearer"></div>
    </div>



    <div class="footer">
    </div>
  </body>
</html>



