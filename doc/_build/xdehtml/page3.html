

<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Transitional//EN"
  "http://www.w3.org/TR/xhtml1/DTD/xhtml1-transitional.dtd">
<html xmlns="http://www.w3.org/1999/xhtml">
  <head>
    <meta http-equiv="Content-Type" content="text/html; charset=utf-8" />
    
    <title>Programming guide &mdash; Serial to Ethernet bridging application manual v documentation</title>

    <link rel="stylesheet" href="_static/pygments.css" type="text/css" />
    <link rel="stylesheet" href="_static/globals.css"  type="text/css" />
    <link rel="stylesheet" href="_static/ui.css" type="text/css" />
    <link rel="stylesheet" href="_static/app.css"  type="text/css" />
    <link rel="stylesheet" href="_static/mobile.css"  type="text/css" />
    <link rel="stylesheet" href="_static/xde.css"
    type="text/css" /><script type="text/javascript" src="_static/scripts.js"></script>
    <script type="text/javascript">
      var DOCUMENTATION_OPTIONS = {
        URL_ROOT:    '',
        VERSION:     '',
        COLLAPSE_INDEX: false,
        FILE_SUFFIX: '.html',
        HAS_SOURCE:  true
      };
    </script>
    <script type="text/javascript" src="_static/jquery.js"></script>
    <script type="text/javascript" src="_static/underscore.js"></script>
    <script type="text/javascript" src="_static/doctools.js"></script>
    <link rel="top" title="Serial to Ethernet bridging application manual v documentation" href="index.html" />
    <link rel="next" title="API" href="page4.html" />
    <link rel="prev" title="System description" href="page2.html" /> 
  </head>
  <body class="xde indented-content" onload="prepareContents();">  
          <div id="body">
             <div id="content">
             <h1>Programming guide</h1>

             <div class='columns'>
            
  <h2 class="topic" id="getting-started">Getting started</h2>
<div><h3 id="installation-of-xtimecomposer-tools-suite">Installation of xTIMEcomposer Tools Suite</h3>
<div><p>The Serial to Ethernet application requires xTIMEcomposer version 13.0.0 or greater. It can be downloaded at the following URL <a class="reference" href="http://www.xmos.com/support/xtools"><span>http://www.xmos.com/support/xtools</span></a></p>
<dl class="docutils">
<dt>The following components are required to build the <em>Serial to Ethernet application</em>:</dt>
<dd><ul class="first last">
<li>sw_serial_to_ethernet: git://github.com/xcore/sw_serial_to_ethernet</li>
<li>sc_multi_uart: git://github.com/xcore/sc_multi_uart.git</li>
<li>sc_xtcp: git://github.com/xcore/sc_xtcp.git</li>
<li>sc_ethernet: git://github.com/xcore/sc_ethernet.git</li>
<li>sc_util: git://github.com/xcore/sc_util.git</li>
<li>sc_website: git://github.com/xcore/sc_website.git</li>
<li>sc_slicekit_support: git://github.com/xcore/sc_slicekit_support</li>
<li>sc_otp: git://github.com/xcore/sc_otp</li>
</ul>
</dd>
</dl>
<p>All these components are packaged as a software distribution. Once this zip file is selected, you can follow the below instructions to build and use the software.</p>
<h4 id="import-and-build-procedure-using-xtimecomposer-studio">Import and build procedure using xTIMEcomposer studio</h4>
<div><p>To install the software, open the xTIMEcomposer (v13.0.0 or later) and follow these steps:</p>
<ol class="arabic simple">
<li>Open the xTIMEcomposer studio.</li>
<li>Open the <em>Edit</em> perspective (Window -&gt; Open Perspective -&gt; XMOS Edit).</li>
<li>Access the Import option either by right clicking the project in the project explorer window or through File -&gt;Import menu</li>
<li>Click <em>Import</em> option in the <em>Project Explorer</em> window (Import -&gt; General -&gt; Existing Projects into Workspace and click Next).</li>
<li>Choose <em>Select archive file</em> option and click <em>Browse</em> button.</li>
<li>Select s2e release zip file and click <em>Finish</em> button</li>
<li>The application is called as <em>app_serial_to_ethernet</em> in the <em>Project Explorer</em> window.</li>
</ol>
<p>Build the <tt class="docutils literal"><span class="pre">serial</span> <span class="pre">to</span> <span class="pre">ethernet</span></tt> application:</p>
<ol class="arabic simple">
<li>Click on the <em>app_serial_to_ethernet</em> item in the <em>Project Explorer</em> window.</li>
<li>Click on the <em>Build</em> (indicated by a &#8216;Hammer&#8217; picture) icon.</li>
<li>Check the <em>Console</em> window to verify that the application has built successfully.</li>
</ol>
</div></div><h3 id="flash-the-web-pages-and-device-configuration">Flash the web pages and device configuration</h3>
<div><p>To flash the web pages and device configuration using xTIMEcomposer studio:</p>
<ol class="arabic simple">
<li>In the <em>Project Explorer</em> window, locate the <em>app_serial_to_ethernet.xe</em> and <em>web_data.bin</em> in the (app_serial_to_ethernet -&gt; bin).</li>
<li>Right click on <em>app_serial_to_ethernet.xe</em> and click on (Flash As -&gt; Flash Configurations...).</li>
<li>In the <em>Flash Configurations</em> window, double click the <em>xCORE Application</em> to create a new flash configuration.</li>
<li>Navigate to <em>XFlash Options</em> tab and apply the following settings:<ul>
<li>Check <em>Boot partition size (bytes):</em> and its value as 0x10000</li>
<li><em>Other XFlash Options:</em> as <tt class="docutils literal"><span class="pre">--data</span> <span class="pre">bin/web_data.bin</span></tt></li>
</ul>
</li>
<li>Click on <em>Apply</em> and then <em>Flash</em> to the XMOS device.</li>
<li>Check the <em>Console</em> window to verify flashing progress.</li>
</ol>
<h4 id="building-from-command-line-tool">Building from command line tool</h4>
<div><p>To build from the command line, navigate to <cite>app_serial_to_ethernet</cite> directory and execute the command:</p>
<blockquote>
<div><p>xmake all</p>
</div></blockquote>
<p>Inorder to build the firmware with a static IP (say 169.254.196.178), execute the following command:</p>
<blockquote>
<div><p>xmake all STATIC_IP=169.254.196.178</p>
</div></blockquote>
<p>To flash the application, configration and web pages, execute the command:</p>
<blockquote>
<div><p>xmake flash</p>
</div></blockquote>
</div></div></div><h2 class="topic" id="source-code-structure">Source code structure</h2>
<div><h3 id="directory-structure">Directory structure</h3>
<div><p>The source code is split into application source code and web pages.
The application builds into a single executable using the source code from the modules.
The modules used by an application are specified using the <tt class="docutils literal"><span class="pre">USED_MODULES</span></tt> variable in
the application Makefile.</p>
<p>The source package contains:</p>
<table border="1" class="docutils">
<colgroup>
<col width="50%" />
<col width="50%" />
</colgroup>
<thead valign="bottom">
<tr><th class="head"><p>Directory</p>
</th>
<th class="head"><p>Description</p>
</th>
</tr>
</thead>
<tbody valign="top">
<tr><td><p>src</p>
</td>
<td><p>Source files that implement application functionality</p>
</td>
</tr>
<tr><td><p>web</p>
</td>
<td><p>Web (html) pages used by the web server module</p>
</td>
</tr>
<tr><td><p>images</p>
</td>
<td><p>Images that are displayed on the web (html) pages</p>
</td>
</tr>
</tbody>
</table>
<p>Supported modules originate from other repositories:</p>
<table border="1" class="docutils">
<colgroup>
<col width="33%" />
<col width="33%" />
<col width="33%" />
</colgroup>
<thead valign="bottom">
<tr><th class="head"><p>Directory</p>
</th>
<th class="head"><p>Description</p>
</th>
<th class="head"><p>Repository</p>
</th>
</tr>
</thead>
<tbody valign="top">
<tr><td><p>module_mii_singlethread</p>
</td>
<td><p>Lite version of low level ethernet interface over MII</p>
</td>
<td><p>sc_ethernet</p>
</td>
</tr>
<tr><td><p>module_ethernet_smi</p>
</td>
<td><p>A library code to communicate with ethernet phy using the SMI protocol</p>
</td>
<td><p>sc_ethernet</p>
</td>
</tr>
<tr><td><p>module_xtcp</p>
</td>
<td><p>XTCP TCP/IP stack</p>
</td>
<td><p>sc_xtcp</p>
</td>
</tr>
<tr><td><p>module_multi_uart</p>
</td>
<td><p>Multiple UART TX server and RX server</p>
</td>
<td><p>sc_multi_uart</p>
</td>
</tr>
<tr><td><p>module_xc_ptr</p>
</td>
<td><p>A library to allow XC code to access pointers via inline assembly calls.</p>
</td>
<td><p>sc_util</p>
</td>
</tr>
<tr><td><p>module_website</p>
</td>
<td><p>Embedded website component</p>
</td>
<td><p>sc_website</p>
</td>
</tr>
<tr><td><p>module_mutual_thread_comm</p>
</td>
<td><p>A protocol that allows two cores to communicate</p>
</td>
<td><p>sc_util</p>
</td>
</tr>
</tbody>
</table>
</div><h3 id="key-files">Key files</h3>
<div><table border="1" class="docutils">
<colgroup>
<col width="50%" />
<col width="50%" />
</colgroup>
<thead valign="bottom">
<tr><th class="head"><p>File</p>
</th>
<th class="head"><p>Description</p>
</th>
</tr>
</thead>
<tbody valign="top">
<tr><td><p><tt class="docutils literal"><span class="pre">xtcp_client_conf.h</span></tt></p>
</td>
<td><p>Header file for clients of the TCP/IP stack.</p>
</td>
</tr>
<tr><td><p><tt class="docutils literal"><span class="pre">udp_discovery.h</span></tt></p>
</td>
<td><p>Header file for declaring UDP port, firmware version and function declarations required for s2e device discovery</p>
</td>
</tr>
<tr><td><p><tt class="docutils literal"><span class="pre">uart_config.h</span></tt></p>
</td>
<td><p>Header file containing delclarations for UART data strcutures and interfacing with multi-uart server component</p>
</td>
</tr>
<tr><td><p><tt class="docutils literal"><span class="pre">web_server_conf.h</span></tt></p>
</td>
<td><p>Header file declaring all the functions called from the web pages</p>
</td>
</tr>
<tr><td><p><tt class="docutils literal"><span class="pre">telnet_config.h</span></tt></p>
</td>
<td><p>Header file for configuring UARTs via telnet socket</p>
</td>
</tr>
<tr><td><p><tt class="docutils literal"><span class="pre">multi_uart_rx_conf.h</span></tt></p>
</td>
<td><p>Header file for multiUART RX server configuration</p>
</td>
</tr>
<tr><td><p><tt class="docutils literal"><span class="pre">multi_uart_tx_conf.h</span></tt></p>
</td>
<td><p>Header file for multiUART TX server configuration</p>
</td>
</tr>
<tr><td><p><tt class="docutils literal"><span class="pre">s2e_conf.h</span></tt></p>
</td>
<td><p>Header file to enable debug options for s2e application</p>
</td>
</tr>
</tbody>
</table>
</div></div><h2 class="topic" id="notes-on-application-interfaces">Notes on application interfaces</h2>
<div><p>This section provides a brief description on main application interfaces.</p>
<h3 id="uart-configuration">UART configuration</h3>
<div><p>The initialisation and configuration process for both the RX and TX operations is the same. The files <tt class="docutils literal"><span class="pre">multi_uart_tx_conf.h</span></tt> and <tt class="docutils literal"><span class="pre">multi_uart_rx_conf.h</span></tt> are used to configure multiUART TX and RX servers for the default values. For application configuration, the function <a class="reference" href="page4.html#uart_config_init" title="uart_config_init"><span>uart_config_init()</span></a> is used to apply configuration stored from flash or to use default application defined static configuration. The function <tt class="xref c c-func docutils literal"><span class="pre">uart_set_config()</span></tt> is utilised whenever there is a dynamic configuration change request (i.e. a particular UART reconfiguration request). The flow is visualised in the figure below.</p>
<div align="center" class="figure" id="fig-uart-init-flow">
<div class="caption"><span>UART configuration flow</span></div>
<img alt="_images/muart_config_flow.png" src="_images/muart_config_flow.png" style="width: 50%;" />
</div>
</div><h3 id="webserver">Webserver</h3>
<div><p>The webserver handles all HTTP requests from the web clients. A web client may request to change UART settings, save current settings, or apply the previously saved UART seetings etc. Webserver identifies these requests, validates them and services those requests. It calls appropriate UART handler api&#8217;s to retrieve and set channel settings. For example, for a &#8216;Set&#8217; request from the web page, the webserver handler utilizes website component in order to parse the form data from web page, the required UART parameters are extracted and the UART_Handler&#8217;s uart_set_config api is called to set the new UART configuration.</p>
<p>The Webserver interface utilises <em>sc_website</em> component to implement web server functionality. Refer to the <cite>Quickstart Guide</cite> within <cite>Documentation</cite> or <cite>Developer Column</cite> of the <tt class="docutils literal"><span class="pre">Slicekit</span> <span class="pre">GPIO</span> <span class="pre">and</span> <span class="pre">Ethernet</span> <span class="pre">Combo</span> <span class="pre">Demo</span></tt> example in xSOFTip browser. This documentation contains more information on how to utilize the <tt class="docutils literal"><span class="pre">Embedded</span> <span class="pre">Webserver</span> <span class="pre">Function</span> <span class="pre">Library</span></tt> component in customizing web server applications.</p>
</div><h3 id="flash-interface">Flash interface</h3>
<div><dl class="docutils">
<dt>The s2e_flash core handles data to/from flash fitted on board. The UART configuration web (html) pages, UART settings and IP configuration are typically stored into flash. Web pages are retrieved upon request from the client to the web server. UART settings can be &#8216;saved&#8217; and &#8216;restored&#8217; from flash. They are usually done via:</dt>
<dd><ul class="first last">
<li>Request from web page (HTTP request)</li>
<li>From Telnet configuration server</li>
<li>Upon startup (to restore restore last saved settings)</li>
</ul>
</dd>
</dl>
<p>IP configuration is saved via UDP server request and is requested from flash upon start-up.</p>
</div></div>

             </div>
             </div>


          </div>

          <div>
             <!--seealsos-->
          </div><div id="local_seealso">
             <h1>See Also</h1>
             <ul class="iconmenu">
             <li><a href="page0.html">Application Overview</a></li>
             <li><a href="page1.html">Hardware platforms</a></li>
             <li><a href="page2.html">System description</a></li>
             <li><a href="page4.html">API</a></li>
             <li><a href="page5.html">Using the application</a></li>
             <li><a href="page6.html">References</a></li>
             </ul>
          </div>
    <div class="footer">
    </div>
  </body>
</html>